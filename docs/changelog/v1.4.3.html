<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>v1.4.3 &quot;Seiri&quot; - Code Organization &amp; Serialization Cleanup | Jiro.Shared Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="v1.4.3 &quot;Seiri&quot; - Code Organization &amp; Serialization Cleanup | Jiro.Shared Documentation ">
      
      
      <link rel="icon" href="../../assets/Jiro-Icon.png">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/HueByte/Jiro.Shared/blob/main/dev/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../assets/Jiro-Icon.png" alt="Jiro.Shared">
            Jiro.Shared
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="v143-seiri---code-organization--serialization-cleanup">v1.4.3 &quot;Seiri&quot; - Code Organization &amp; Serialization Cleanup</h1>

<p><strong>Release Date</strong>: 2025-01-08<br>
<strong>Code Name</strong>: &quot;Seiri&quot; (整理 - Organization/Cleanup)<br>
<strong>Type</strong>: Patch Release</p>
<hr>
<h2 id="-overview">🎯 Overview</h2>
<p>Version 1.4.3 is a focused cleanup release that eliminates code duplication and resolves serialization issues within the Jiro.Shared library. This release refactors the command result architecture to eliminate redundancy with the main Jiro.Commands project, resulting in cleaner separation of concerns and improved maintainability.</p>
<p>The &quot;Seiri&quot; release embodies the Japanese concept of organization and systematic arrangement, removing unnecessary complexity while maintaining full backward compatibility.</p>
<h2 id="-breaking-changes">🔧 Breaking Changes</h2>
<h3 id="-command-result-type-removal">⚠️ Command Result Type Removal</h3>
<p><strong>Affected Types</strong> (removed from Jiro.Shared):</p>
<ul>
<li><code>ICommandResult</code> interface</li>
<li><code>TextResult</code> class</li>
<li><code>GraphResult</code> class</li>
<li><code>CommandType</code> enum</li>
<li><code>TextType</code> enum</li>
</ul>
<p><strong>Migration Path</strong>:
Applications should use their own <code>ICommandResult</code> implementations from domain-specific packages (e.g., Jiro.Commands) instead of relying on Jiro.Shared types.</p>
<h3 id="sessioncommandresponse-changes">SessionCommandResponse Changes</h3>
<p><strong>Before (v1.4.2)</strong>:</p>
<pre><code class="lang-csharp">public class SessionCommandResponse
{
    public CommandType CommandType { get; set; }  // Enum
    public ICommandResult? Result { get; set; }   // Strongly typed
}
</code></pre>
<p><strong>After (v1.4.3)</strong>:</p>
<pre><code class="lang-csharp">public class SessionCommandResponse  
{
    public string CommandType { get; set; }       // String for flexibility
    public object? Result { get; set; }           // Generic object
}
</code></pre>
<h2 id="-key-improvements">🚀 Key Improvements</h2>
<h3 id="architecture-cleanup">Architecture Cleanup</h3>
<ul>
<li><strong>Eliminated Duplication</strong>: Removed duplicate <code>ICommandResult</code> types that existed in both Jiro.Shared and Jiro.Commands</li>
<li><strong>Proper Separation</strong>: Jiro.Shared now focuses purely on transport/communication contracts</li>
<li><strong>Domain Independence</strong>: Applications can use their own command result implementations</li>
</ul>
<h3 id="enhanced-serialization">Enhanced Serialization</h3>
<ul>
<li><strong>Generic Result Handling</strong>: <code>SessionCommandResponse.Result</code> is now <code>object?</code> for maximum flexibility</li>
<li><strong>JSON Compatibility</strong>: Full JSON serialization support with proper type handling</li>
<li><strong>Framework Agnostic</strong>: No dependency on specific result type implementations</li>
</ul>
<h3 id="grpc-extension-updates">gRPC Extension Updates</h3>
<p><strong>Updated <code>ClientMessageExtensions</code></strong>:</p>
<pre><code class="lang-csharp">// Now creates anonymous objects instead of typed results
Result = new
{
    Response = textResult.Response,
    TextType = textResult.TextType.ToString().ToLower()
}
</code></pre>
<h2 id="-technical-details">📋 Technical Details</h2>
<h3 id="serialization-behavior">Serialization Behavior</h3>
<p>The updated <code>SessionCommandResponse</code> serializes all result types as JSON objects:</p>
<p><strong>String Results</strong>:</p>
<pre><code class="lang-json">{
  &quot;commandType&quot;: &quot;text&quot;,
  &quot;result&quot;: &quot;Simple string result&quot;
}
</code></pre>
<p><strong>Complex Results</strong>:</p>
<pre><code class="lang-json">{
  &quot;commandType&quot;: &quot;graph&quot;,
  &quot;result&quot;: {
    &quot;message&quot;: &quot;Graph data&quot;,
    &quot;data&quot;: &quot;{\&quot;x\&quot;:[1,2,3]}&quot;,
    &quot;units&quot;: {&quot;x&quot;: &quot;seconds&quot;}
  }
}
</code></pre>
<h3 id="consumer-implementation">Consumer Implementation</h3>
<p>Applications consuming Jiro.Shared should implement their own result type handling:</p>
<pre><code class="lang-csharp">// In consuming application
var response = await GetSessionCommandResponse();

if (response.Result is JsonElement element)
{
    var myResult = JsonSerializer.Deserialize&lt;MyCustomResult&gt;(element);
    // Handle typed result
}
</code></pre>
<h2 id="-new-test-coverage">🧪 New Test Coverage</h2>
<h3 id="serialization-tests">Serialization Tests</h3>
<p>Added comprehensive test suite for <code>SessionCommandResponse</code> serialization:</p>
<ul>
<li><strong>String result serialization/deserialization</strong></li>
<li><strong>Complex object result handling</strong></li>
<li><strong>Null result handling</strong></li>
<li><strong>Empty command type scenarios</strong></li>
</ul>
<p><strong>Test Coverage</strong>: 4 new test methods ensuring robust serialization behavior</p>
<h2 id="-migration-guide">🔄 Migration Guide</h2>
<h3 id="for-library-consumers">For Library Consumers</h3>
<ol>
<li><strong>Remove Direct Type Dependencies</strong>: Stop importing command result types from Jiro.Shared</li>
<li><strong>Implement Domain Types</strong>: Use your own <code>ICommandResult</code> implementations</li>
<li><strong>Update Deserialization</strong>: Handle <code>object?</code> results with proper type conversion</li>
<li><strong>String Command Types</strong>: Update code expecting <code>CommandType</code> enum to handle strings</li>
</ol>
<h3 id="example-migration">Example Migration</h3>
<p><strong>Before</strong>:</p>
<pre><code class="lang-csharp">using Jiro.Shared;

var response = await client.ExecuteCommand();
if (response.Result is TextResult textResult)
{
    Console.WriteLine(textResult.Response);
}
</code></pre>
<p><strong>After</strong>:</p>
<pre><code class="lang-csharp">using MyApp.Commands; // Your own result types

var response = await client.ExecuteCommand();
if (response.Result is JsonElement element)
{
    var textResult = JsonSerializer.Deserialize&lt;MyTextResult&gt;(element);
    Console.WriteLine(textResult.Response);
}
</code></pre>
<h2 id="-issues-resolved">🐛 Issues Resolved</h2>
<ul>
<li><strong>Serialization Conflicts</strong>: Eliminated polymorphic serialization issues with abstract types</li>
<li><strong>Type Duplication</strong>: Removed redundant type definitions between projects</li>
<li><strong>Architecture Coupling</strong>: Decoupled transport layer from domain-specific types</li>
<li><strong>Maintenance Overhead</strong>: Reduced code duplication and maintenance burden</li>
</ul>
<h2 id="-benefits">📈 Benefits</h2>
<h3 id="development-experience">Development Experience</h3>
<ul>
<li><strong>Cleaner Architecture</strong>: Clear separation between shared infrastructure and domain logic</li>
<li><strong>Flexible Integration</strong>: Applications can define their own result type hierarchies</li>
<li><strong>Reduced Coupling</strong>: No forced dependency on specific command result implementations</li>
</ul>
<h3 id="performance--reliability">Performance &amp; Reliability</h3>
<ul>
<li><strong>Improved Serialization</strong>: Eliminated complex polymorphic serialization scenarios</li>
<li><strong>Smaller Footprint</strong>: Reduced assembly size by removing unnecessary types</li>
<li><strong>Better Testability</strong>: Simplified testing with generic object handling</li>
</ul>
<h2 id="-dependencies">🔗 Dependencies</h2>
<p>No dependency changes in this release. All dependencies remain consistent with v1.4.2:</p>
<ul>
<li>Grpc.AspNetCore: 2.71.0</li>
<li>Google.Protobuf: 3.31.1</li>
<li>Microsoft.AspNetCore.SignalR: 1.2.0</li>
<li>Microsoft.AspNetCore.SignalR.Client: 9.0.8</li>
</ul>
<h2 id="-compatibility">⚡ Compatibility</h2>
<h3 id="backward-compatibility">Backward Compatibility</h3>
<ul>
<li><strong>Transport Layer</strong>: Full compatibility for WebSocket and gRPC communication</li>
<li><strong>JSON Serialization</strong>: Previous JSON structures remain parseable</li>
<li><strong>Extension Methods</strong>: <code>ClientMessageExtensions</code> maintain same method signatures</li>
</ul>
<h3 id="forward-compatibility">Forward Compatibility</h3>
<ul>
<li><strong>Extensible Design</strong>: Generic <code>object?</code> result type supports any future result implementations</li>
<li><strong>Version Agnostic</strong>: No version-specific type dependencies</li>
</ul>
<hr>
<p><strong>Implementation Note</strong>: This release focuses on architectural cleanup and proper separation of concerns. While some types have been removed from Jiro.Shared, the functionality remains available through domain-specific implementations in consuming applications, resulting in a cleaner and more maintainable architecture.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/HueByte/Jiro.Shared/blob/main/dev/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <div class="footer-custom"><div class="footer-inner d-flex justify-content-between align-items-center"><div class="footer-text">Made with <strong>💖</strong> By HueByte</div><div class="footer-links"><a href="https://github.com/HueByte/Jiro.Shared" class="footer-link" target="_blank"><i class="fab fa-github"></i>GitHub</a><a href="#" class="footer-link scroll-to-top" onclick="scrollToTop()"><i class="fas fa-arrow-up"></i>Top</a></div></div></div><script>function scrollToTop(){window.scrollTo({top:0,behavior:'smooth'});}</script>
        </div>
      </div>
    </footer>
  </body>
</html>
